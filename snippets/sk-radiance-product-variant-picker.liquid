{%- unless product.has_only_default_variant -%}
  <variant-selects
    class="sk-radiance-variant-selects no-js-hidden"
    data-section="{{ section.id }}"
    data-url="{{ product.url }}"
    data-update-url="false"
    {{ block.shopify_attributes }}
  >
    <fieldset class="sk-radiance-variant-selects__fieldset js product-form__input">
      <div class="sk-radiance-variant-cards">
        {%- for variant in product.variants -%}
          {%- assign inventory_management = variant.inventory_management -%}
          {%- assign inventory_quantity = variant.inventory_quantity | default: 0 -%}
          {%- assign is_out_of_stock = false -%}
          {%- if variant.available == false or (inventory_management != blank and inventory_quantity <= 0) -%}
            {%- assign is_out_of_stock = true -%}
          {%- endif -%}
          {%- assign is_active = false -%}
          {%- if variant.id == product.selected_or_first_available_variant.id and is_out_of_stock == false -%}
            {%- assign is_active = true -%}
          {%- endif -%}
          {%- assign bundle_title_field = variant.metafields.custom.bundle_title -%}
          {%- assign bundle_title = variant.title -%}
          {%- if bundle_title_field -%}
            {%- assign bundle_title = bundle_title_field.value | default: bundle_title_field | default: bundle_title -%}
          {%- endif -%}
          {%- assign variant_subtitle_field = variant.metafields.custom.variant_subtitle -%}
          {%- assign variant_subtitle = '' -%}
          {%- if variant_subtitle_field -%}
            {%- assign variant_subtitle = variant_subtitle_field.value
              | default: variant_subtitle_field
              | default: variant_subtitle
            -%}
          {%- endif -%}
          {%- assign popularity_flag = variant.metafields.custom.is_popular -%}
          {%- assign popularity_value = popularity_flag.value | default: popularity_flag -%}
          {%- assign is_popular = false -%}
          {%- if popularity_value == true or popularity_value == 'true' -%}
            {%- assign is_popular = true -%}
          {%- endif -%}
          <div class="sk-radiance-variant-card{% if is_active %} sk-radiance-variant-card--active{% endif %}{% if is_out_of_stock %} sk-radiance-variant-card--disabled{% endif %}">
            <label class="sk-radiance-variant-card__label" for="VariantCard-{{ variant.id }}">
              <input
                id="VariantCard-{{ variant.id }}"
                class="sk-radiance-variant-card__input"
                type="radio"
                name="id"
                value="{{ variant.id }}"
                form="{{ product_form_id }}"
                {% if is_active %}
                  checked
                {% endif %}
                {% if is_out_of_stock %}
                  disabled
                {% endif %}
              >
              <div class="sk-radiance-variant-card__image">
                {%- if variant.featured_image -%}
                  <img
                    src="{{ variant.featured_image | image_url: width: 320 }}"
                    alt="{{ variant.featured_image.alt | escape }}"
                    width="320"
                    height="320"
                    loading="lazy"
                  >
                {%- else -%}
                  <img
                    src="{{ product.featured_image | image_url: width: 320 }}"
                    alt="{{ product.featured_image.alt | escape }}"
                    width="320"
                    height="320"
                    loading="lazy"
                  >
                {%- endif -%}
              </div>
              <div class="sk-radiance-variant-card__content">
                <div class="sk-radiance-variant-card__heading">
                  <h3 class="sk-radiance-variant-card__title">{{ bundle_title }}</h3>
                  {%- if is_popular %}
                    <span class="sk-radiance-variant-card__badge">Most popular</span>
                  {%- endif -%}
                </div>
                {% if variant_subtitle != blank %}
                  <p class="sk-radiance-variant-card__subtitle">{{ variant_subtitle }}</p>
                {% endif %}
              </div>
            </label>
          </div>
        {%- endfor -%}
      </div>
    </fieldset>
    <script type="application/json">
      {{ product.variants | json }}
    </script>
  </variant-selects>
{%- endunless -%}

<noscript class="sk-radiance-variant-selects product-form__noscript-wrapper-{{ section.id }}">
  <div class="sk-radiance-variant-selects__fieldset">
    <div class="sk-radiance-variant-selects__legend form__label">
      {{ 'products.product.product_variants' | t }}
    </div>
    <div class="sk-radiance-variant-selects__select-wrapper">
      <select
        name="id"
        id="Variants-{{ section.id }}"
        class="sk-radiance-variant-selects__select"
        form="{{ product_form_id }}"
      >
        {%- for variant in product.variants -%}
          <option
            {% if variant == product.selected_or_first_available_variant %}
              selected="selected"
            {% endif %}
            {% if variant.available == false %}
              disabled
            {% endif %}
            value="{{ variant.id }}"
          >
            {{ variant.title }}
            {%- if variant.available == false -%}
              - {{ 'products.product.sold_out' | t }}
            {%- endif -%}
          </option>
        {%- endfor -%}
      </select>
    </div>
  </div>
</noscript>
