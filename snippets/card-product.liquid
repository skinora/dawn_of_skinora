{%- comment -%}
  SKINORA â€” CurrentBody-style product card
{%- endcomment -%}

{%- assign product = card_product -%}

<div class="cb-card">

  <!-- IMAGE -->
  <a href="{{ product.url }}" class="cb-card__image-link">
    <div class="cb-card__image-wrapper">
      {%- if product.featured_media -%}
        <img
          src="{{ product.featured_media | image_url: width: 600 }}"
          alt="{{ product.featured_media.alt | escape }}"
          class="cb-card__image"
          loading="lazy"
          width="{{ product.featured_media.width }}"
          height="{{ product.featured_media.height }}"
        >
      {%- else -%}
        {{ 'product-apparel-2' | placeholder_svg_tag: 'cb-card__image' }}
      {%- endif -%}
    </div>
  </a>

  <!-- CONTENT -->
  <div class="cb-card__content">

    <!-- TITLE -->
    <h3 class="cb-card__title">
      <a href="{{ product.url }}">
        {{ product.title }}
      </a>
    </h3>

    <!-- SUBTITLE (uses product.description OR metafield if you prefer later) -->
    {%- if product.description != blank -%}
      <p class="cb-card__subtitle">
        {{ product.description | strip_html | truncate: 90 }}
      </p>
    {%- endif -%}

    <!-- PRICE + RATING -->
    <div class="cb-card__meta">
      <div class="cb-card__price">
        {% render 'price', product: product %}
      </div>

      {%- if show_rating -%}
        {% render 'rating-stars', product: product %}
      {%- endif -%}
    </div>

    <!-- VARIANT PICKER (only if multiple variants) -->
    {%- assign variant_count = product.variants | size -%}
    {%- if variant_count > 1 -%}
      <form class="cb-card__variants">
        <select name="id" class="cb-card__variant-select">
          {%- for v in product.variants -%}
            <option value="{{ v.id }}"{% if v == product.selected_or_first_available_variant %} selected{% endif %}>
              {{ v.title }}
            </option>
          {%- endfor -%}
        </select>
      </form>
    {%- endif -%}

    <!-- ADD TO CART BUTTON -->
    <form method="post" action="/cart/add" class="cb-card__cart">
      <input
        type="hidden"
        name="id"
        value="{{ product.selected_or_first_available_variant.id }}"
      >
      <button type="submit" class="cb-card__button" {% unless product.available %}disabled{% endunless %}>
        {% if product.available %}
          {{ 'products.product.add_to_cart' | t }}
        {% else %}
          {{ 'products.product.sold_out' | t }}
        {% endif %}
      </button>
    </form>

  </div>
</div>
