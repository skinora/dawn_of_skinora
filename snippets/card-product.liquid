{%- comment -%}
  SKINORA â€” CurrentBody-style product card
{%- endcomment -%}

{%- assign product = card_product -%}

<div class="cb-card">
  <!-- IMAGE -->
  <a href="{{ product.url }}" class="cb-card__image-link">
    <div class="cb-card__image-wrapper">
      {%- if product.featured_media -%}
        <img
          src="{{ product.featured_media | image_url: width: 600 }}"
          alt="{{ product.featured_media.alt | escape }}"
          class="cb-card__image"
          loading="lazy"
          width="{{ product.featured_media.width }}"
          height="{{ product.featured_media.height }}"
        >
      {%- else -%}
        {{ 'product-apparel-2' | placeholder_svg_tag: 'cb-card__image' }}
      {%- endif -%}
    </div>
  </a>

  <!-- CONTENT -->
  <div class="cb-card__content">
    <!-- TITLE -->
    <h3 class="cb-card__title">
      <a href="{{ product.url }}">
        {{ product.title }}
      </a>
    </h3>

    <!-- SUBTITLE (uses product.description OR metafield if you prefer later) -->
    {%- assign short_description = product.description | strip_html | replace: '\n', ' ' | strip -%}
    {%- if short_description == blank and product.metafields.custom.product_subtitle != blank -%}
      {%- assign short_description = product.metafields.custom.product_subtitle.value
        | strip_html
        | replace: '\n', ' '
        | strip
      -%}
    {%- endif -%}

    {%- if short_description != blank -%}
      <p class="cb-card__subtitle">
        {{ short_description | truncate: 110 }}
      </p>
    {%- endif -%}

    <!-- PRICE + RATING -->
    <div class="cb-card__meta">
      <div class="cb-card__price">
        {% render 'price', product: product %}
      </div>

      {%- if show_rating -%}
        {%- comment -%} Okendo star rating widget for product cards {%- endcomment -%}
        <div
          class="okeReviews okeReviews--reviewsSummary-starRating"
          data-oke-reviews-product-id="shopify-{{ product.id }}"
          data-oke-star-rating
        ></div>
      {%- endif -%}
    </div>

    <!-- ADD TO CART BUTTON & VARIANTS -->
    {%- assign variant_count = product.variants | size -%}
    {% form 'product', product, class: 'cb-card__cart' %}
      {%- if variant_count > 1 -%}
        {%- assign option_count = product.options | size -%}
        {%- if option_count == 1 -%}
          <div class="cb-card__variants" role="radiogroup" aria-label="{{ product.options.first }}">
            {%- for variant in product.variants -%}
              <label
                class="cb-card__variant-swatch{% unless variant.available %} is-disabled{% endunless %}"
                title="{{ variant.option1 | escape }}"
                aria-label="{{ variant.option1 | escape }}"
              >
                <input
                  class="cb-card__variant-input"
                  type="radio"
                  name="id"
                  value="{{ variant.id }}"
                  {% if variant == product.selected_or_first_available_variant %}
                    checked
                  {% endif %}
                  {% unless variant.available %}
                    disabled
                  {% endunless %}
                >
                <span class="cb-card__variant-chip">{{ variant.option1 | truncate: 6, '' }}</span>
              </label>
            {%- endfor -%}
          </div>
        {%- else -%}
          <div class="cb-card__variants cb-card__variants--dropdown">
            <label class="visually-hidden" for="CardVariantSelect-{{ product.id }}">
              {{ 'products.product.choose_options' | t }}
            </label>
            <select id="CardVariantSelect-{{ product.id }}" name="id" class="cb-card__variant-select">
              {%- for variant in product.variants -%}
                <option
                  value="{{ variant.id }}"
                  {% if variant == product.selected_or_first_available_variant %}
                    selected
                  {% endif %}
                  {% unless variant.available %}
                    disabled
                  {% endunless %}
                >
                  {{ variant.title }}
                </option>
              {%- endfor -%}
            </select>
          </div>
        {%- endif -%}
      {%- else -%}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
      {%- endif -%}

      <button
        type="submit"
        class="cb-card__button"
        {% unless product.available %}
          disabled
        {% endunless %}
      >
        {% if product.available %}
          {{ 'products.product.add_to_cart' | t }}
        {% else %}
          {{ 'products.product.sold_out' | t }}
        {% endif %}
      </button>
    {% endform %}
  </div>
</div>
