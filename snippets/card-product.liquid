{%- comment -%}
  SKINORA â€” CurrentBody-style product card
{%- endcomment -%}

{%- unless skip_styles -%}
  {{ 'component-rating.css' | asset_url | stylesheet_tag }}
  {{ 'component-volume-pricing.css' | asset_url | stylesheet_tag }}
  {{ 'component-price.css' | asset_url | stylesheet_tag }}
  {{ 'quick-order-list.css' | asset_url | stylesheet_tag }}
  {{ 'quantity-popover.css' | asset_url | stylesheet_tag }}
{%- endunless -%}

{%- if card_product and card_product != empty -%}
  {%- liquid
    assign ratio = 1

    if card_product.featured_media and media_aspect_ratio == 'portrait'
      assign ratio = 0.8
    elsif card_product.featured_media and media_aspect_ratio == 'adapt'
      assign ratio = card_product.featured_media.aspect_ratio
    endif

    if ratio == 0 or ratio == null
      assign ratio = 1
    endif
  -%}

  <div class="card-wrapper product-card-wrapper underline-links-hover">
    <article class="cb-card" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
      {%- comment -%} IMAGE WRAPPER {%- endcomment -%}
      <a href="{{ card_product.url }}" class="cb-card__media-link">
        <div
          class="cb-card__media-wrapper ratio"
          style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;"
        >
          {%- render 'card-product-image',
            card_product: card_product,
            media_aspect_ratio: media_aspect_ratio,
            image_shape: image_shape,
            lazy_load: lazy_load,
            settings: settings,
            section_id: section_id,
            show_secondary_image: show_secondary_image
          -%}
        </div>
      </a>

      {%- comment -%} CONTENT {%- endcomment -%}
      <div class="cb-card__content card__content">
        <div class="card__information">
          <h3 class="cb-card__title">
            <a href="{{ card_product.url }}" class="full-unstyled-link">
              {{ card_product.title | escape }}
            </a>
          </h3>

          {%- if card_product.description != blank -%}
            <p class="cb-card__excerpt">
              {{ card_product.description | strip_html | truncate: 120 }}
            </p>
          {%- endif -%}

          <div class="cb-card__bottom">
            <div class="cb-card__price">
              {%- render 'price',
                product: card_product,
                price_class: 'price--large'
              -%}
            </div>

            {%- if show_rating -%}
              <div class="cb-card__rating">
                {%- render 'rating', product: card_product -%}
              </div>
            {%- endif -%}
          </div>

          {%- comment -%} ADD TO CART BUTTON (no quick-add dependency) {%- endcomment -%}
          {%- if card_product.available -%}
            <div class="cb-card__button">
              <form method="post" action="/cart/add" class="cb-card__addtocart">
                <input
                  type="hidden"
                  name="id"
                  value="{{ card_product.selected_or_first_available_variant.id }}"
                >
                <button type="submit" class="cb-card__button-el">
                  {{ 'products.product.add_to_cart' | t }}
                </button>
              </form>
            </div>
          {%- else -%}
            <div class="cb-card__button cb-card__button--disabled">
              <button type="button" class="cb-card__button-el" disabled>
                {{ 'products.product.sold_out' | t }}
              </button>
            </div>
          {%- endif -%}
        </div>
      </div>
    </article>
  </div>

{%- else -%}
  {%- liquid
    assign ratio = 1
    assign placeholder = true

    if media_aspect_ratio == 'portrait'
      assign ratio = 0.8
    endif
  -%}

  <div class="card-wrapper product-card-wrapper underline-links-hover">
    <article class="cb-card cb-card--placeholder" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
      <div class="cb-card__media-wrapper ratio">
        <div class="card__media">
          <div class="media media--transparent">
            {%- if placeholder_image -%}
              {{ placeholder_image | placeholder_svg_tag: 'placeholder-svg' }}
            {%- else -%}
              {{ 'product-apparel-2' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </div>
        </div>
      </div>

      <div class="cb-card__content card__content">
        <div class="card__information">
          <h3 class="cb-card__title card__heading--placeholder">
            <a role="link" aria-disabled="true" class="full-unstyled-link">
              {{ 'onboarding.product_title' | t }}
            </a>
          </h3>

          <div class="cb-card__bottom">
            {% render 'price', placeholder: placeholder, show_compare_at_price: true %}
          </div>
        </div>
      </div>
    </article>
  </div>
{%- endif -%}
