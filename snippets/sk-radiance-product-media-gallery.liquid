{%- liquid
  assign media_count = product.media.size
  if media_count == 0
    assign single_media_visible = true
  endif

  assign media_count = product.media.size
  if media_count == 0
    assign single_media_visible = true
  endif

  assign media_aspect_ratio = product.featured_media.aspect_ratio
  unless media_aspect_ratio
    assign media_aspect_ratio = 1
  endunless

  assign desktop_columns = 1
  assign desktop_carousel = false
  assign mobile_carousel = false
  assign media_contains_model = false

  if media_count > 1
    assign mobile_carousel = true
  endif

  if media_count > 1
    assign desktop_carousel = true
  endif

  for media in product.media
    if media.media_type == 'model'
      assign media_contains_model = true
      break
    endif
  endfor
-%}

<div class="sk-radiance-product__media-wrapper">
  <div class="sk-radiance-product__media sk-radiance-product__media--{{ section.settings.media_size }} sk-radiance-product__media--{{ section.settings.media_position }} sk-radiance-product__media--{{ section.settings.gallery_layout }} sk-radiance-product__media--mobile-{{ section.settings.mobile_thumbnails }} grid grid--1-col grid--2-col-tablet">
    <!-- Main Media Display -->
    <div class="sk-radiance-product__media-main grid__item">
      <div class="sk-radiance-product__media-container">
        {%- if product.media.size > 0 -%}
          <div class="sk-radiance-product__media-slider" data-media-count="{{ media_count }}">
            {%- for media in product.media -%}
              <div
                class="sk-radiance-product__media-item{% if forloop.first %} sk-radiance-product__media-item--active{% endif %}"
                data-media-id="{{ media.id }}"
              >
                {%- case media.media_type -%}
                  {%- when 'image' -%}
                    <div class="sk-radiance-product__media-image">
                      <img
                        srcset="
                          {%- if media.width >= 165 -%}{{ media | image_url: width: 165 }} 165w,{%- endif -%}
                          {%- if media.width >= 360 -%}{{ media | image_url: width: 360 }} 360w,{%- endif -%}
                          {%- if media.width >= 533 -%}{{ media | image_url: width: 533 }} 533w,{%- endif -%}
                          {%- if media.width >= 720 -%}{{ media | image_url: width: 720 }} 720w,{%- endif -%}
                          {%- if media.width >= 940 -%}{{ media | image_url: width: 940 }} 940w,{%- endif -%}
                          {%- if media.width >= 1066 -%}{{ media | image_url: width: 1066 }} 1066w,{%- endif -%}
                          {{ media | image_url }} {{ media.width }}w
                        "
                        src="{{ media | image_url: width: 533 }}"
                        sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                        alt="{{ media.alt | escape }}"
                        class="sk-radiance-product__media-image-element"
                        loading="lazy"
                        width="{{ media.width }}"
                        height="{{ media.height }}"
                      >
                    </div>
                  {%- when 'video' -%}
                    <div class="sk-radiance-product__media-video">
                      {{
                        media
                        | video_tag:
                          image_size: '2048x',
                          loop: section.settings.enable_video_looping,
                          controls: true,
                          muted: true
                      }}
                    </div>
                  {%- when 'external_video' -%}
                    <div class="sk-radiance-product__media-external-video">
                      {{ media | external_video_tag }}
                    </div>
                  {%- when 'model' -%}
                    <div class="sk-radiance-product__media-model">
                      {{ media | model_viewer_tag: image_size: '2048x', reveal: 'interaction', toggleable: true }}
                    </div>
                {%- endcase -%}
              </div>
            {%- endfor -%}
          </div>

          <!-- Navigation Arrows -->
          {%- if media_count > 1 -%}
            <button
              class="sk-radiance-product__media-nav sk-radiance-product__media-nav--prev"
              type="button"
              aria-label="Previous media"
            >
              <span class="svg-wrapper">
                {{- 'icon-chevron-left.svg' | inline_asset_content -}}
              </span>
            </button>
            <button
              class="sk-radiance-product__media-nav sk-radiance-product__media-nav--next"
              type="button"
              aria-label="Next media"
            >
              <span class="svg-wrapper">
                {{- 'icon-chevron-right.svg' | inline_asset_content -}}
              </span>
            </button>
          {%- endif -%}
        {%- else -%}
          <div class="sk-radiance-product__media-placeholder">
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        {%- endif -%}
      </div>
    </div>

    <!-- Thumbnail Gallery -->
    {%- if media_count > 1 and section.settings.gallery_layout == 'thumbnail_slider' -%}
      <div class="sk-radiance-product__media-thumbnails">
        <div class="sk-radiance-product__media-thumbnails-container">
          {%- for media in product.media -%}
            <button
              class="sk-radiance-product__media-thumbnail{% if forloop.first %} sk-radiance-product__media-thumbnail--active{% endif %}"
              type="button"
              data-media-id="{{ media.id }}"
              aria-label="View media {{ forloop.index }}"
            >
              {%- case media.media_type -%}
                {%- when 'image' -%}
                  <img
                    src="{{ media | image_url: width: 100 }}"
                    alt="{{ media.alt | escape }}"
                    class="sk-radiance-product__media-thumbnail-image"
                    loading="lazy"
                    width="100"
                    height="100"
                  >
                {%- when 'video' -%}
                  <div class="sk-radiance-product__media-thumbnail-video">
                    <img
                      src="{{ media.preview_image | image_url: width: 100 }}"
                      alt="{{ media.alt | escape }}"
                      class="sk-radiance-product__media-thumbnail-image"
                      loading="lazy"
                      width="100"
                      height="100"
                    >
                    <div class="sk-radiance-product__media-thumbnail-play">
                      {{- 'icon-play.svg' | inline_asset_content -}}
                    </div>
                  </div>
                {%- when 'external_video' -%}
                  <div class="sk-radiance-product__media-thumbnail-external-video">
                    <img
                      src="{{ media.preview_image | image_url: width: 100 }}"
                      alt="{{ media.alt | escape }}"
                      class="sk-radiance-product__media-thumbnail-image"
                      loading="lazy"
                      width="100"
                      height="100"
                    >
                    <div class="sk-radiance-product__media-thumbnail-play">
                      {{- 'icon-play.svg' | inline_asset_content -}}
                    </div>
                  </div>
                {%- when 'model' -%}
                  <div class="sk-radiance-product__media-thumbnail-model">
                    <img
                      src="{{ media.preview_image | image_url: width: 100 }}"
                      alt="{{ media.alt | escape }}"
                      class="sk-radiance-product__media-thumbnail-image"
                      loading="lazy"
                      width="100"
                      height="100"
                    >
                    <div class="sk-radiance-product__media-thumbnail-model-icon">
                      {{- 'icon-3d.svg' | inline_asset_content -}}
                    </div>
                  </div>
              {%- endcase -%}
            </button>
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const mediaSlider = document.querySelector('.sk-radiance-product__media-slider');
    const thumbnails = document.querySelectorAll('.sk-radiance-product__media-thumbnail');
    const prevBtn = document.querySelector('.sk-radiance-product__media-nav--prev');
    const nextBtn = document.querySelector('.sk-radiance-product__media-nav--next');
    const mediaItems = document.querySelectorAll('.sk-radiance-product__media-item');

    let currentIndex = 0;
    const totalItems = mediaItems.length;

    function updateActiveMedia(index) {
      // Update main media
      mediaItems.forEach((item, i) => {
        item.classList.toggle('sk-radiance-product__media-item--active', i === index);
      });

      // Update thumbnails
      thumbnails.forEach((thumb, i) => {
        thumb.classList.toggle('sk-radiance-product__media-thumbnail--active', i === index);
      });
    }

    function showNext() {
      currentIndex = (currentIndex + 1) % totalItems;
      updateActiveMedia(currentIndex);
    }

    function showPrev() {
      currentIndex = (currentIndex - 1 + totalItems) % totalItems;
      updateActiveMedia(currentIndex);
    }

    // Thumbnail click handlers
    thumbnails.forEach((thumb, index) => {
      thumb.addEventListener('click', () => {
        currentIndex = index;
        updateActiveMedia(currentIndex);
      });
    });

    // Navigation button handlers
    if (nextBtn) {
      nextBtn.addEventListener('click', showNext);
    }

    if (prevBtn) {
      prevBtn.addEventListener('click', showPrev);
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        showPrev();
      } else if (e.key === 'ArrowRight') {
        showNext();
      }
    });
  });
</script>
